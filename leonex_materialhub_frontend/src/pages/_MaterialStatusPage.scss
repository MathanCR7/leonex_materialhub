// src/pages/_MaterialStatusPage.scss

@use "sass:color";
@use "../scss/utils/variables" as var;
@use "../scss/utils/mixins" as mix;
@use "../components/Pagination";

// The breakpoint where the mobile card view switches to the desktop table view
$table-breakpoint: 992px;

.material-status-page {
  animation: fadeIn 0.4s ease-out;

  .page-header {
    margin-bottom: var.$spacer-4;
  }

  // --- CONTROLS BAR: FLEXIBLE & RESPONSIVE ---
  .controls-bar {
    margin-bottom: var.$spacer-5;
    display: flex;
    flex-direction: column; // Stack items vertically on mobile
    gap: var.$spacer-3;
    @include mix.card-style($padding: var.$spacer-3);

    @include mix.screen-breakpoint(md) {
      flex-direction: row; // Horizontal layout on desktop
      align-items: center;
      padding: var.$spacer-2 var.$spacer-4;
    }
  }

  .search-bar-status {
    display: flex;
    align-items: center;
    flex-grow: 1;
    width: 100%;

    .search-icon {
      color: var.$text-muted;
      margin: 0 var.$spacer-3;
    }

    .search-input.form-control {
      border: none;
      box-shadow: none;
      padding: var.$spacer-3 var.$spacer-2;
      font-size: var.$font-size-base;
      width: 100%;
      background-color: transparent;
      border-radius: var.$border-radius;

      &:focus {
        box-shadow: var.$box-shadow-focus;
        background-color: color.adjust(var.$surface-light, $alpha: -0.5);
      }
    }
  }

  // Wrapper for filter and export buttons
  .controls-actions {
    display: flex;
    width: 100%;
    gap: var.$spacer-3;
    justify-content: space-between;

    @include mix.screen-breakpoint(md) {
      width: auto;
      flex-shrink: 0;
    }

    .status-filter-container {
      flex-grow: 1;
      min-width: 180px;
       @include mix.screen-breakpoint(sm) {
         flex-grow: 0;
       }
    }
  }

  // --- MOBILE-FIRST TABLE STYLING ---
  .submissions-table-container {
    background-color: transparent;
    border: none;
    box-shadow: none;

    @include mix.screen-breakpoint(lg) {
      @include mix.card-style($padding: 0);
      overflow-x: auto;
    }
  }

  .submissions-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;

    // --- DESKTOP TABLE VIEW ---
    @include mix.screen-breakpoint(lg) {
      border-collapse: collapse;
      min-width: 900px;

      th, td { padding: var.$spacer-3 var.$spacer-4; text-align: left; border-bottom: 1px solid var.$border-color-light; vertical-align: middle; }
      th { font-size: var.$font-size-sm; font-weight: var.$font-weight-semibold; text-transform: uppercase; color: var.$text-secondary; background-color: var.$surface-light; cursor: pointer; -webkit-user-select: none; user-select: none; white-space: nowrap; transition: color 0.2s ease;
        &:hover { color: var.$text-primary; }
        svg { margin-left: var.$spacer-2; vertical-align: middle; }
      }
      tbody tr { transition: background-color 0.2s ease-in-out;
        &:nth-of-type(even) { background-color: var.$surface-light; }
        &:hover { background-color: var.$primary-light; td { color: var.$text-primary; } }
        td { color: var.$text-secondary; font-size: var.$font-size-base; }
      }
    }

    // --- ATTRACTIVE MOBILE CARD VIEW ---
    @media (max-width: ($table-breakpoint - 1)) {
      // =============================================================
      // === FIX FOR OVERFLOW ON PAGE CHANGE =========================
      // =============================================================
      table-layout: fixed; // This is the critical line that fixes the bug
      // =============================================================
      // =============================================================

      thead { display: none; }

      tr {
        display: block;
        @include mix.card-style($padding: 0);
        margin-bottom: var.$spacer-4;
        border-left: 4px solid var.$primary;
        overflow: hidden;

        &:hover, &:focus-within {
          transform: translateY(-3px);
          box-shadow: var.$box-shadow-lg;
        }
      }

      td {
        display: block;
        padding: var.$spacer-3 var.$spacer-4;
        border-bottom: 1px solid var.$border-color-light;
        
        &::before {
          content: attr(data-label);
          display: block;
          font-size: var.$font-size-xs;
          font-weight: var.$font-weight-semibold;
          color: var.$text-muted;
          text-transform: uppercase;
          margin-bottom: var.$spacer-1;
        }
        
        &[data-label="Description"] {
          font-size: var.$font-size-sm;
          color: var.$text-secondary;
          line-height: 1.5;
          overflow-wrap: break-word;
          word-break: break-all;
        }

        &[data-label="Material Code"] {
          font-size: 1.1rem;
          font-weight: var.$font-weight-semibold;
          color: var.$text-primary;
          background-color: var.$surface-light;
        }
        
        &[data-label="Actions"] {
          background-color: var.$surface-light;
          text-align: right;
          border-bottom: none;
          padding: var.$spacer-2 var.$spacer-4;
          &::before { display: none; }
        }
      }
    }
  }

  // --- PAGINATION & FOOTER ---
  .pagination-controls { display: flex; flex-direction: column-reverse; align-items: center; gap: var.$spacer-4; margin-top: var.$spacer-5; padding-top: var.$spacer-4; width: 100%; border-top: 1px solid var.$border-color-light;
    @include mix.screen-breakpoint(md) { flex-direction: row; justify-content: space-between; }
  }
  .pagination-summary { font-size: var.$font-size-sm; color: var.$text-muted; text-align: center; }
}

// --- STATUS BADGE STYLING ---
.status-badge { padding: 0.3em 0.8em; border-radius: var.$border-radius-pill; font-size: var.$font-size-xs; font-weight: var.$font-weight-bold; color: #fff; text-transform: uppercase; min-width: 100px; text-align: center; display: inline-block; letter-spacing: 0.5px; border: 1px solid rgba(0, 0, 0, 0.1);
  &.status-approved { background-color: var.$success; }
  &.status-reworkrequested { background-color: var.$danger; }
  &.status-reworkcompleted { background-color: var.$warning; }
  &.status-pending { background-color: var.$secondary; }
}

// --- FILTER DROPDOWN STYLING ---
.status-filter-container { position: relative; }
.filter-button { @include mix.flex-center($justify: space-between); background-color: transparent; border: 1px solid var.$border-color; padding: var.$spacer-2 var.$spacer-3; border-radius: var.$border-radius; cursor: pointer; width: 100%; transition: var.$transition-default;
  &:hover, &.is-open { background-color: var.$surface-light; border-color: var.$primary; }
  .filter-label { color: var.$text-secondary; font-size: var.$font-size-sm; display: flex; align-items: center; gap: var.$spacer-2; font-weight: var.$font-weight-medium; strong { color: var.$text-primary; } }
  .chevron-icon { color: var.$text-muted; transition: transform 0.2s ease; }
  &.is-open .chevron-icon { transform: rotate(180deg); }
}
.filter-dropdown { position: absolute; top: calc(100% + 4px); right: 0; background-color: var.$surface-color; border: 1px solid var.$border-color; border-radius: var.$border-radius; box-shadow: var.$box-shadow-lg; z-index: var.$z-index-modal; width: 280px; padding: var.$spacer-2; animation: fadeIn 0.2s ease-out; }
.filter-dropdown ul { list-style: none; padding: 0; margin: 0; }
.filter-dropdown li { border-radius: var.$border-radius-sm; transition: background-color 0.2s ease; &:hover { background-color: var.$primary-light; } }
.filter-dropdown label { display: flex; align-items: center; gap: var.$spacer-3; font-size: var.$font-size-base; cursor: pointer; width: 100%; padding: var.$spacer-2 var.$spacer-3; }
.filter-dropdown input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; accent-color: var.$primary; }
.filter-dropdown .filter-actions { display: flex; justify-content: space-between; align-items: center; padding: var.$spacer-2 var.$spacer-3; border-top: 1px solid var.$border-color-light; margin-top: var.$spacer-2;
  .btn-link { background: none; border: none; color: var.$primary; font-size: var.$font-size-sm; font-weight: var.$font-weight-semibold; cursor: pointer; padding: var.$spacer-1; &:hover { text-decoration: underline; } }
}

// --- BUTTON STYLING ---
.btn-export { @include mix.flex-center; border: none; cursor: pointer; transition: background-color 0.2s ease, box-shadow 0.2s ease; background-color: var.$success; color: #fff; border-radius: var.$border-radius; padding: var.$spacer-2 var.$spacer-4; font-weight: var.$font-weight-semibold; gap: var.$spacer-2; white-space: nowrap;
  span { display: none; @include mix.screen-breakpoint(sm) { display: inline; } }
  &:hover { background-color: color.adjust(var.$success, $lightness: -5%); box-shadow: var.$box-shadow-sm; }
  &:disabled { background-color: var.$secondary; cursor: not-allowed; opacity: 0.7; }
}

.btn-icon {
  background: transparent;
  border: none;
  color: var.$text-secondary;
  padding: var.$spacer-2;
  cursor: pointer;
  border-radius: 50%;
  line-height: 0;
  transition: all 0.2s ease;

  &:hover {
    color: var.$primary;
    background-color: var.$primary-light;
  }
}

// --- ANIMATION ---
@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }